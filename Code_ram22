import pandas as pd

def nettoyer_variables_objet(df, seuil_na=0.95, seuil_mode=0.95, max_cardinalite=50):
    colonnes_objet = df.select_dtypes(include='object').columns
    colonnes_a_supprimer = []

    for col in colonnes_objet:
        serie = df[col]
        n_unique = serie.nunique(dropna=True)
        taux_na = serie.isna().mean()
        taux_valeur_mode = serie.value_counts(normalize=True, dropna=True).iloc[0] if n_unique > 0 else 1

        # Règles de suppression
        if n_unique <= 1:
            colonnes_a_supprimer.append(col)
        elif taux_na >= seuil_na:
            colonnes_a_supprimer.append(col)
        elif taux_valeur_mode >= seuil_mode:
            colonnes_a_supprimer.append(col)
        elif 'dt' in col.lower() or 'date' in col.lower():
            colonnes_a_supprimer.append(col)
        elif any(x in col.lower() for x in ['nom', 'ref', 'client', 'adresse', 'geoplan', 'rue', 'cuser', 'projet']):
            colonnes_a_supprimer.append(col)
        elif n_unique > max_cardinalite:
            colonnes_a_supprimer.append(col)

    print(f"🔍 Colonnes supprimées : {len(colonnes_a_supprimer)} / {len(colonnes_objet)}")
    return df.drop(columns=colonnes_a_supprimer), colonnes_a_supprimer
