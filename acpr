import pandas as pd
import matplotlib.pyplot as plt

# Récupérer le classifieur CatBoost du pipeline final
clf_final = final_pipe.named_steps["clf"]

# Importance des variables
importances = clf_final.get_feature_importance()
fi_df = pd.DataFrame({
    "feature": X_train_final.columns,
    "importance": importances
}).sort_values("importance", ascending=False)

print("\nTop 20 variables importantes :")
print(fi_df.head(20))

# Tracer le Top k
k = 20
fi_top = fi_df.head(k).iloc[::-1]  # pour afficher de bas en haut
plt.figure(figsize=(8, 6))
plt.barh(fi_top["feature"], fi_top["importance"])
plt.xlabel("Importance (CatBoost)")
plt.ylabel("Variables")
plt.title(f"Importance des variables – Modèle final (Top {k})")
plt.tight_layout()
plt.show()
