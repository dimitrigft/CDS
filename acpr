from sklearn.model_selection import StratifiedGroupKFold

# 1. Préparer X, y, groups
X = df_train_val.drop(columns=["SINISTRE", "SINISTRE_BINARY", "TRIM_YEAR", "CONTRAT", "INSEE_COM", "NOMBRE_SINISTRES"])
y = df_train_val["SINISTRE_BINARY"]
groups = df_train_val["CONTRAT"]

# 2. Créer les folds
sgkf = StratifiedGroupKFold(n_splits=4, shuffle=True, random_state=42)
folds = []

for fold, (train_idx, val_idx) in enumerate(sgkf.split(X, y, groups=groups)):
    print(f"\nFold {fold + 1} :")
    print(f"  - Taille train : {len(train_idx)}")
    print(f"  - Taille val   : {len(val_idx)}")
    print(f"  - Prop. sinistres (val) : {y.iloc[val_idx].mean():.4f}")
    
    folds.append((train_idx, val_idx))
